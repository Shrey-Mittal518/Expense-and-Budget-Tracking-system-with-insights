{% extends "base.html" %}

{% block title %}Transactions{% endblock %}

{% block content %}
<div class="card">
    <h2>Transactions</h2>
    <div style="margin-bottom: 15px;">
        <button onclick="showImportModal()" style="margin-right: 10px;">Import CSV/OFX</button>
        <button onclick="showAddModal()">Add Transaction</button>
    </div>

    {% if transactions %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Merchant</th>
                <th>Category</th>
                <th>Amount</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for t in transactions %}
            <tr>
                <td>{{ t.date }}</td>
                <td>{{ t.merchant }}</td>
                <td>{{ t.category }}</td>
                <td>
                    <span style="color: {% if t.amount < 0 %}#f44336{% else %}#4CAF50{% endif %};">
                        {% if t.amount < 0 %}-{% else %}+{% endif %}â‚¹{{ "%.2f"|format(t.amount|abs) }}
                    </span>
                </td>
                <td>
                    <form method="POST" action="{{ url_for('delete_transaction', transaction_id=t.id) }}" style="display: inline;">
                        <button type="submit" class="btn-danger" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-center">No transactions yet. Add your first transaction or import from a file.</p>
    {% endif %}
</div>

<!-- Add Transaction Modal -->
<div id="addModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Add Transaction</div>
        <form method="POST" action="{{ url_for('add_transaction') }}">
            <div class="form-group">
                <label>Merchant</label>
                <input type="text" name="merchant" required>
            </div>
            <div class="form-group">
                <label>Amount (negative for expense, positive for income)</label>
                <input type="number" name="amount" step="0.01" required>
            </div>
            <div class="form-group">
                <label>Date</label>
                <input type="date" name="date" required>
            </div>
            <div class="form-group">
                <label>Category</label>
                <select name="category" required>
                    <option value="">Select Category</option>
                    {% for cat in categories %}
                    <option>{{ cat }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>Envelope (optional)</label>
                <select name="envelope_id">
                    <option value="">No Envelope</option>
                    {% for env in envelopes %}
                    <option value="{{ env.id }}">{{ env.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea name="notes" rows="2"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="hideAddModal()" class="btn-secondary">Cancel</button>
                <button type="submit">Add</button>
            </div>
        </form>
    </div>
</div>

<!-- Import Modal -->
<div id="importModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Import Transactions</div>
        <form method="POST" action="{{ url_for('import_transactions') }}" enctype="multipart/form-data">
            <div class="form-group">
                <label>File (CSV, OFX, QFX)</label>
                <input type="file" name="file" accept=".csv,.ofx,.qfx" required>
                <small>Supported formats: CSV, OFX, QFX</small>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="hideImportModal()" class="btn-secondary">Cancel</button>
                <button type="submit">Import</button>
            </div>
        </form>
    </div>
</div>

<script>
function showAddModal() {
    document.getElementById('addModal').style.display = 'block';
}
function hideAddModal() {
    document.getElementById('addModal').style.display = 'none';
}
function showImportModal() {
    document.getElementById('importModal').style.display = 'block';
}
function hideImportModal() {
    document.getElementById('importModal').style.display = 'none';
}
window.onclick = function(event) {
    var modals = ['addModal', 'importModal'];
    modals.forEach(function(modalId) {
        var modal = document.getElementById(modalId);
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    });
}
</script>
{% endblock %}
